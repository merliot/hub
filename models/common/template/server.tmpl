// Autogenerated from server.tmpl

package main

import (
	"github.com/merliot/dean"
	"github.com/merliot/hub/models/{{.model}}"
)

func main() {
	thing := {{.model}}.New("{{.id}}", "{{.model}}", "{{.name}}").(*{{.model}}.{{.modelStruct}})

	thing.SetDeployParams("{{.deployParams}}")
	thing.PingPeriod = 1

	server := dean.NewServer(thing)

{{template "server-extras.tmpl" .}}
	if "{{.hub}}" != "" {
		server.DialWebSocket("{{.user}}", "{{.passwd}}", "{{.hub}}", thing.Announce())
	}

	if "{{.backupHub}}" != "" {
		server.DialWebSocket("{{.user}}", "{{.passwd}}", "{{.backupHub}}", thing.Announce())
	}

	if "{{.http}}" == "on" {
		server.BasicAuth("{{.user}}", "{{.passwd}}")
		if "{{.port}}" != "" {
			server.Addr = ":{{.port}}"
		}
		go server.ListenAndServe()
	}

	server.Run()
}

// Autogenerated from server.tmpl

package main

import (
	"github.com/merliot/dean"
	"github.com/merliot/hub/models/{{.model}}"
)

func main() {
	thing := {{.model}}.New("{{.id}}", "{{.model}}", "{{.name}}").(*{{.model}}.{{.modelStruct}})

	thing.SetDeployParams("{{.deployParams}}")

	server := dean.NewServer(thing)

{{template "server-extras.tmpl" .}}
	if "{{.hub}}" != "" {
		server.DialWebSocket("{{.user}}", "{{.passwd}}", "{{.wsscheme}}{{.hub}}/ws/", thing.Announce())
	}

	if "{{.backuphub}}" != "" {
		server.DialWebSocket("{{.user}}", "{{.passwd}}", "{{.backupwsscheme}}{{.backuphub}}/ws/", thing.Announce())
	}

	if "{{.http}}" == "on" {
		server.BasicAuth("{{.user}}", "{{.passwd}}")
		if "{{.port}}" != "" {
			server.Addr = ":{{.port}}"
		}
		go server.ListenAndServe()
	}

	server.Run()
}
